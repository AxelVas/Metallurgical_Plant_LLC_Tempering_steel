# Металлургический комбинат ООО «Так закаляем сталь»
![image](https://user-images.githubusercontent.com/76148212/122690917-f9710c80-d234-11eb-8550-6f706f3a7615.png)

## Задача: <br>
Чтобы оптимизировать производственные расходы, металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали. Вам предстоит построить модель, которая предскажет температуру стали.


## Описание этапа обработки 

Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша. 

Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).

Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.

Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (англ. *slab*, «плита»).


## Описание данных

Данные состоят из файлов, полученных из разных источников:

- `data_arc.csv` — данные об электродах;
- `data_bulk.csv` — данные о подаче сыпучих материалов (объём);
- `data_bulk_time.csv` *—* данные о подаче сыпучих материалов (время);
- `data_gas.csv` — данные о продувке сплава газом;
- `data_temp.csv` — результаты измерения температуры;
- `data_wire.csv` — данные о проволочных материалах (объём);
- `data_wire_time.csv` — данные о проволочных материалах (время).


Во всех файлах столбец `key` содержит номер партии. В файлах может быть несколько строк с одинаковым значением `key`: они соответствуют разным итерациям обработки.
## Краткое описание проведённой работы:
> Мы постарились использовать максимальное количество данных из тех что предоставил заказчик и на этих данных обучили три модели `DecisionTreeRegressor`,`LinearRegression` и `CatBoostRegressor`. <br> По итогам сравнения метрик качества предсказаний из трёх моделей лидирует `CatBoostRegressor`, которая достигла значения в **4.56** по метрике **MAE** <br> Таким образом мы достигли требуемого значения **MAE <6.00**, а так же дополнительно выяснили наиболее важные данные на которых строилось предсказание нашей наилучшей модели, **ТОП-3** из которых это "*Температура в начале замера, Время нагрева в секундах и Средняя активная мощность*"

## Стэк:
`Python`
`Pandas`
`Matplotlib`
`исследовательский анализ данных`
`визуализация данных`
`предобработка данных`
`Seaborn`
`numpy`
`sklearn`
`машинное обучение`
-----




<h1>Подробное описание проекта<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#Загружаем-библиотеки" data-toc-modified-id="Загружаем-библиотеки-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Загружаем библиотеки</a></span></li><li><span><a href="#Загружаем-данные" data-toc-modified-id="Загружаем-данные-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Загружаем данные</a></span></li><li><span><a href="#Выполним-исследовательский-анализ-данных" data-toc-modified-id="Выполним-исследовательский-анализ-данных-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Выполним исследовательский анализ данных</a></span><ul class="toc-item"><li><span><a href="#Приведём-формат-даты-к-формату-Datetime" data-toc-modified-id="Приведём-формат-даты-к-формату-Datetime-3.1"><span class="toc-item-num">3.1&nbsp;&nbsp;</span>Приведём формат даты к формату <code>Datetime</code></a></span></li></ul></li><li><span><a href="#Посмотрим-на-распределение-мощностей-и-отобразим-их-на-одном-графике" data-toc-modified-id="Посмотрим-на-распределение-мощностей-и-отобразим-их-на-одном-графике-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Посмотрим на распределение мощностей и отобразим их на одном графике</a></span><ul class="toc-item"><li><span><a href="#Для-начала-проверим-выбросы-в-данных-при-помощи-boxplot" data-toc-modified-id="Для-начала-проверим-выбросы-в-данных-при-помощи-boxplot-4.1"><span class="toc-item-num">4.1&nbsp;&nbsp;</span>Для начала проверим выбросы в данных при помощи <code>boxplot</code></a></span></li><li><span><a href="#Удалим-выбивающееся-значение-из-нашей-таблицы" data-toc-modified-id="Удалим-выбивающееся-значение-из-нашей-таблицы-4.2"><span class="toc-item-num">4.2&nbsp;&nbsp;</span>Удалим выбивающееся значение из нашей таблицы</a></span></li><li><span><a href="#Посторим-гистограммы-распределения" data-toc-modified-id="Посторим-гистограммы-распределения-4.3"><span class="toc-item-num">4.3&nbsp;&nbsp;</span>Посторим гистограммы распределения</a></span></li></ul></li><li><span><a href="#Определим-первую-и-последнюю-замеры-теператур" data-toc-modified-id="Определим-первую-и-последнюю-замеры-теператур-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Определим первую и последнюю замеры теператур</a></span><ul class="toc-item"><li><span><a href="#Удалим-столбец-&quot;Температура-в-конце-замера&quot;,-т.к.-присвоенные-данные-по-последнему-замеру-температуры-не-соответствуют-своему-времени-если-были-допущены-пропуски" data-toc-modified-id="Удалим-столбец-&quot;Температура-в-конце-замера&quot;,-т.к.-присвоенные-данные-по-последнему-замеру-температуры-не-соответствуют-своему-времени-если-были-допущены-пропуски-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>Удалим столбец "Температура в конце замера", т.к. присвоенные данные по последнему замеру температуры не соответствуют своему времени если были допущены пропуски</a></span></li></ul></li><li><span><a href="#Добавим-температуру-поcледнего-замера-по-значению-ключа-и-времени" data-toc-modified-id="Добавим-температуру-поcледнего-замера-по-значению-ключа-и-времени-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>Добавим температуру поcледнего замера по значению ключа и времени</a></span><ul class="toc-item"><li><span><a href="#Мы-видим-пропущенные-значения-в-целевом-столбце,-такие-данные-лучше-не-заполнять-средним-или-другим-значением,-по-этому-удалим-строки-без-замеренных-данных-по-температуре" data-toc-modified-id="Мы-видим-пропущенные-значения-в-целевом-столбце,-такие-данные-лучше-не-заполнять-средним-или-другим-значением,-по-этому-удалим-строки-без-замеренных-данных-по-температуре-6.1"><span class="toc-item-num">6.1&nbsp;&nbsp;</span>Мы видим пропущенные значения в целевом столбце, такие данные лучше не заполнять средним или другим значением, по-этому удалим строки без замеренных данных по температуре</a></span></li><li><span><a href="#Выведем-распределение-значения-целевого-признака-на-график" data-toc-modified-id="Выведем-распределение-значения-целевого-признака-на-график-6.2"><span class="toc-item-num">6.2&nbsp;&nbsp;</span>Выведем распределение значения целевого признака на график</a></span></li></ul></li><li><span><a href="#Посмотрим-визульно-на-распределение-данных-в-нашей-таблице-при-помощи-pairplot" data-toc-modified-id="Посмотрим-визульно-на-распределение-данных-в-нашей-таблице-при-помощи-pairplot-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>Посмотрим визульно на распределение данных в нашей таблице при помощи <code>pairplot</code></a></span><ul class="toc-item"><li><span><a href="#Оперделим-длительность-времени-между-первым-и-последним-замером-температуры." data-toc-modified-id="Оперделим-длительность-времени-между-первым-и-последним-замером-температуры.-7.1"><span class="toc-item-num">7.1&nbsp;&nbsp;</span>Оперделим длительность времени между первым и последним замером температуры.</a></span></li><li><span><a href="#Найдём-суммарное-время-нагрева-электродами-по-каждому-key" data-toc-modified-id="Найдём-суммарное-время-нагрева-электродами-по-каждому-key-7.2"><span class="toc-item-num">7.2&nbsp;&nbsp;</span>Найдём суммарное время нагрева электродами по каждому <code>key</code></a></span></li><li><span><a href="#Отобразим-на-графике" data-toc-modified-id="Отобразим-на-графике-7.3"><span class="toc-item-num">7.3&nbsp;&nbsp;</span>Отобразим на графике</a></span></li></ul></li><li><span><a href="#По-всем-полученным-столбцам-вычислим-статистики:-средние,-минимальные-и-максимальные-значения,-медиану-и-величины-25%--и-75%-квартилей." data-toc-modified-id="По-всем-полученным-столбцам-вычислим-статистики:-средние,-минимальные-и-максимальные-значения,-медиану-и-величины-25%--и-75%-квартилей.-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>По всем полученным столбцам вычислим статистики: средние, минимальные и максимальные значения, медиану и величины 25%- и 75%-квартилей.</a></span><ul class="toc-item"><li><span><a href="#--Для-этого-объеденим-все-полученные-столбцы-с-основной-таблицей" data-toc-modified-id="--Для-этого-объеденим-все-полученные-столбцы-с-основной-таблицей-8.1"><span class="toc-item-num">8.1&nbsp;&nbsp;</span>- Для этого объеденим все полученные столбцы с основной таблицей</a></span></li><li><span><a href="#Выведем-средние,-минимальные-и-максимальные-значения,-медиану-и-величины-25%--и-75%-квартилей" data-toc-modified-id="Выведем-средние,-минимальные-и-максимальные-значения,-медиану-и-величины-25%--и-75%-квартилей-8.2"><span class="toc-item-num">8.2&nbsp;&nbsp;</span>Выведем средние, минимальные и максимальные значения, медиану и величины 25%- и 75%-квартилей</a></span></li></ul></li><li><span><a href="#Объединим-все-интересующие-нас-данные-в-одну-таблицу-с-учётом-фильтра-по-последней-замеренной-температуре-и-добавим-дополнительных-данных-о-лигирующих-присадках" data-toc-modified-id="Объединим-все-интересующие-нас-данные-в-одну-таблицу-с-учётом-фильтра-по-последней-замеренной-температуре-и-добавим-дополнительных-данных-о-лигирующих-присадках-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>Объединим все интересующие нас данные в одну таблицу с учётом фильтра по последней замеренной температуре и добавим дополнительных данных о лигирующих присадках</a></span><ul class="toc-item"><li><span><a href="#Добавим-дополнительных-данных-о-лигирующих-присадках-в-общую-таблицу" data-toc-modified-id="Добавим-дополнительных-данных-о-лигирующих-присадках-в-общую-таблицу-9.1"><span class="toc-item-num">9.1&nbsp;&nbsp;</span>Добавим дополнительных данных о лигирующих присадках в общую таблицу</a></span></li><li><span><a href="#Заполним-пропущенные-значения-по-каждому-столбцу-'Bulk'" data-toc-modified-id="Заполним-пропущенные-значения-по-каждому-столбцу-'Bulk'-9.2"><span class="toc-item-num">9.2&nbsp;&nbsp;</span>Заполним пропущенные значения по каждому столбцу 'Bulk'</a></span></li><li><span><a href="#Выберем-из-таблицы-data_wire-единственный-заполненный-столбец-'Wire-1'-и-заполним-пропуски-средним-значением-по-столбцу" data-toc-modified-id="Выберем-из-таблицы-data_wire-единственный-заполненный-столбец-'Wire-1'-и-заполним-пропуски-средним-значением-по-столбцу-9.3"><span class="toc-item-num">9.3&nbsp;&nbsp;</span>Выберем из таблицы <code>data_wire</code> единственный заполненный столбец 'Wire 1' и заполним пропуски средним значением по столбцу</a></span><ul class="toc-item"><li><span><a href="#Заполним-данные-по-&quot;wire&quot;" data-toc-modified-id="Заполним-данные-по-&quot;wire&quot;-9.3.1"><span class="toc-item-num">9.3.1&nbsp;&nbsp;</span>Заполним данные по "wire"</a></span></li></ul></li><li><span><a href="#Добавим-данные-по-проволоке-из-таблицы-wire-в-финальную-таблицу-по-ключу-key" data-toc-modified-id="Добавим-данные-по-проволоке-из-таблицы-wire-в-финальную-таблицу-по-ключу-key-9.4"><span class="toc-item-num">9.4&nbsp;&nbsp;</span>Добавим данные по проволоке из таблицы <code>wire</code> в финальную таблицу по ключу <code>key</code></a></span></li><li><span><a href="#Добавим-данные-по-присадкам-из-таблицы-bulk-в-финальную-таблицу-по-ключу-key" data-toc-modified-id="Добавим-данные-по-присадкам-из-таблицы-bulk-в-финальную-таблицу-по-ключу-key-9.5"><span class="toc-item-num">9.5&nbsp;&nbsp;</span>Добавим данные по присадкам из таблицы <code>bulk</code> в финальную таблицу по ключу <code>key</code></a></span></li><li><span><a href="#Добавим-данные-по-охлаждению-газом-из-таблицы-data_gas-в-финальную-таблицу-по-ключу-key" data-toc-modified-id="Добавим-данные-по-охлаждению-газом-из-таблицы-data_gas-в-финальную-таблицу-по-ключу-key-9.6"><span class="toc-item-num">9.6&nbsp;&nbsp;</span>Добавим данные по охлаждению газом из таблицы <code>data_gas</code> в финальную таблицу по ключу <code>key</code></a></span></li><li><span><a href="#Проверим-наличие-пропущенных-значений-NAN-и-удалим-строки-имеющие-пропуски" data-toc-modified-id="Проверим-наличие-пропущенных-значений-NAN-и-удалим-строки-имеющие-пропуски-9.7"><span class="toc-item-num">9.7&nbsp;&nbsp;</span>Проверим наличие пропущенных значений <code>NAN</code> и удалим строки имеющие пропуски</a></span></li><li><span><a href="#Вытащим-из-колонки-&quot;Суммарное-время-нагрева-электродами&quot;,-который-находится-в-формате-timedelta-значение-в-секундах-и-добавим-в-финальную-таблицу" data-toc-modified-id="Вытащим-из-колонки-&quot;Суммарное-время-нагрева-электродами&quot;,-который-находится-в-формате-timedelta-значение-в-секундах-и-добавим-в-финальную-таблицу-9.8"><span class="toc-item-num">9.8&nbsp;&nbsp;</span>Вытащим из колонки "Суммарное время нагрева электродами", который находится в формате <code>timedelta</code> значение в секундах и добавим в финальную таблицу</a></span></li><li><span><a href="#Вытащим-из-колонки-&quot;Длительность-между-замерами-температур&quot;,-который-находится-в-формате-timedelta-значение-в-секундах-и-добавим-в-финальную-таблицу" data-toc-modified-id="Вытащим-из-колонки-&quot;Длительность-между-замерами-температур&quot;,-который-находится-в-формате-timedelta-значение-в-секундах-и-добавим-в-финальную-таблицу-9.9"><span class="toc-item-num">9.9&nbsp;&nbsp;</span>Вытащим из колонки "Длительность между замерами температур", который находится в формате <code>timedelta</code> значение в секундах и добавим в финальную таблицу</a></span></li><li><span><a href="#Удалим-колонки-с-форматами-timedelta-и-datetime-для-использования-нашей-таблицы-в-моделях,-а-так-же-колонку-key,-т.к.-она-не-несёт-никаких-бизнес-показателй-для-определения-целевого-признака" data-toc-modified-id="Удалим-колонки-с-форматами-timedelta-и-datetime-для-использования-нашей-таблицы-в-моделях,-а-так-же-колонку-key,-т.к.-она-не-несёт-никаких-бизнес-показателй-для-определения-целевого-признака-9.10"><span class="toc-item-num">9.10&nbsp;&nbsp;</span>Удалим колонки с форматами <code>timedelta</code> и <code>datetime</code> для использования нашей таблицы в моделях, а так же колонку <code>key</code>, т.к. она не несёт никаких бизнес-показателй для определения целевого признака</a></span></li><li><span><a href="#Посмотрим-на-коррелирующие-данные-в-нашей-финальной-таблице" data-toc-modified-id="Посмотрим-на-коррелирующие-данные-в-нашей-финальной-таблице-9.11"><span class="toc-item-num">9.11&nbsp;&nbsp;</span>Посмотрим на коррелирующие данные в нашей финальной таблице</a></span></li></ul></li><li><span><a href="#Определим-тестовую-и-тренировочные-выборки" data-toc-modified-id="Определим-тестовую-и-тренировочные-выборки-10"><span class="toc-item-num">10&nbsp;&nbsp;</span>Определим тестовую и тренировочные выборки</a></span></li><li><span><a href="#Тестируем-первую-модель-DecisionTreeRegressor" data-toc-modified-id="Тестируем-первую-модель-DecisionTreeRegressor-11"><span class="toc-item-num">11&nbsp;&nbsp;</span>Тестируем первую модель <code>DecisionTreeRegressor</code></a></span><ul class="toc-item"><li><span><a href="#Создадим-функцию-по-выводу-графика-зависимости-предсказанных-от-истинных-значений-и-метрик-качества-предсказания" data-toc-modified-id="Создадим-функцию-по-выводу-графика-зависимости-предсказанных-от-истинных-значений-и-метрик-качества-предсказания-11.1"><span class="toc-item-num">11.1&nbsp;&nbsp;</span>Создадим функцию по выводу графика зависимости предсказанных от истинных значений и метрик качества предсказания</a></span></li><li><span><a href="#Посмотрим-на-график-и-данные-метрик" data-toc-modified-id="Посмотрим-на-график-и-данные-метрик-11.2"><span class="toc-item-num">11.2&nbsp;&nbsp;</span>Посмотрим на график и данные метрик</a></span></li></ul></li><li><span><a href="#Тестируем-вторую-модель-LinearRegression" data-toc-modified-id="Тестируем-вторую-модель-LinearRegression-12"><span class="toc-item-num">12&nbsp;&nbsp;</span>Тестируем вторую модель <code>LinearRegression</code></a></span><ul class="toc-item"><li><span><a href="#Посмотрим-на-график-и-данные-метрик" data-toc-modified-id="Посмотрим-на-график-и-данные-метрик-12.1"><span class="toc-item-num">12.1&nbsp;&nbsp;</span>Посмотрим на график и данные метрик</a></span></li></ul></li><li><span><a href="#Тестируем-третью-модель-CatBoostRegressor" data-toc-modified-id="Тестируем-третью-модель-CatBoostRegressor-13"><span class="toc-item-num">13&nbsp;&nbsp;</span>Тестируем третью модель <code>CatBoostRegressor</code></a></span><ul class="toc-item"><li><span><a href="#Посмотрим-на-график-и-данные-метрик" data-toc-modified-id="Посмотрим-на-график-и-данные-метрик-13.1"><span class="toc-item-num">13.1&nbsp;&nbsp;</span>Посмотрим на график и данные метрик</a></span></li></ul></li><li><span><a href="#Найдём-факторы-важности-наилучшей-модели" data-toc-modified-id="Найдём-факторы-важности-наилучшей-модели-14"><span class="toc-item-num">14&nbsp;&nbsp;</span>Найдём факторы важности наилучшей модели</a></span><ul class="toc-item"><li><span><a href="#Судя-по-распределению-важности-данных-можем-откинуть-лишние-данные---это-Газ-1-и-сильно-кореелирующую-Сердняя-реактивная-мощность,-т.к.-Средняя-активная-мощность-имеет-больший-вес-в-предсказании-данных" data-toc-modified-id="Судя-по-распределению-важности-данных-можем-откинуть-лишние-данные---это-Газ-1-и-сильно-кореелирующую-Сердняя-реактивная-мощность,-т.к.-Средняя-активная-мощность-имеет-больший-вес-в-предсказании-данных-14.1"><span class="toc-item-num">14.1&nbsp;&nbsp;</span>Судя по распределению важности данных можем откинуть лишние данные - это <code>Газ 1</code> и сильно кореелирующую <code>Сердняя реактивная мощность</code>, т.к. <code>Средняя активная мощность</code> имеет больший вес в предсказании данных</a></span></li><li><span><a href="#Проверим-теперь-эти-данные-на-нашей-моделе" data-toc-modified-id="Проверим-теперь-эти-данные-на-нашей-моделе-14.2"><span class="toc-item-num">14.2&nbsp;&nbsp;</span>Проверим теперь эти данные на нашей моделе</a></span></li></ul></li><li><span><a href="#Подведём-итоги-предсказаний-наших-моделей-и-сведём-данные-в-одну-таблицу" data-toc-modified-id="Подведём-итоги-предсказаний-наших-моделей-и-сведём-данные-в-одну-таблицу-15"><span class="toc-item-num">15&nbsp;&nbsp;</span>Подведём итоги предсказаний наших моделей и сведём данные в одну таблицу</a></span></li><li><span><a href="#Отчёт-по-решению" data-toc-modified-id="Отчёт-по-решению-16"><span class="toc-item-num">16&nbsp;&nbsp;</span>Отчёт по решению</a></span></li><li><span><a href="#Комментарий-от-ТимЛида" data-toc-modified-id="Комментарий-от-ТимЛида-17"><span class="toc-item-num">17&nbsp;&nbsp;</span><span style="color: green">Комментарий от ТимЛида<span></span></span></a></span></li></ul></div>
